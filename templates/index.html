<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="/static/resources/bread.png" type="image/png">
    <meta charset="UTF-8">
    <title>Botan or baton?</title>
    <link rel="stylesheet" href="/static/styles/styles.css" type="text/css">
    <link rel="stylesheet" href="/static/styles/auth_styles.css" type="text/css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@1,200&family=Montserrat:wght@600&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Acme&family=Dancing+Script:wght@600&family=Mali:ital,wght@1,200&family=Montserrat:wght@600&family=Public+Sans&family=Secular+One&display=swap" rel="stylesheet">

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let btn = document.querySelector('input[id=enter]');
            btn.addEventListener('click', async function (event) {
                event.preventDefault();
                let response = await fetch("/token", {
                    method: "POST",
                    body: new FormData(document.querySelector("form"))
                })
                if (response.status === 403){
                    let wrong_div = document.querySelector("#WrongUser");
                    wrong_div.style.display = "block";
                }
                if (response.status === 200){
                    let data = await response.json()
                    localStorage.setItem('token', data.access_token);
                    let new_html = (await fetch("/groups", {
                        method: "GET"
                    })).text();
                    document.documentElement.innerHTML = (await new_html).toString();
                    window.history.pushState({},"", "/groups");
                }
            })
            let btn2 = document.querySelector('input[id=register_but]');
            btn2.addEventListener('click', async function (event) {
                event.preventDefault()
                let response = await fetch("/user/register", {
                    method: "POST",
                    body: new FormData(document.querySelector("form"))
                })
                if (response.status === 200)
                    alert("Успешно!");
                else
                    alert("Упс, произошла ошибка")
            });
        });

    </script>
</head>
<body id="main_body">
    <header>
        <img src="/static/resources/bread.png" onclick="" alt="bread_logo" id="main_logo"><h1 id="logo_h1"> BOtan</h1>
    </header>
    <main id="main">
        <div id="desc">
            <p >
                Данный сервис поможет вам изучать, зубрить, запоминать,
                просто-ботать ваши любимые предметы и темы
            </p>
        </div>

        <div id="abilities">
            <p>
                Здесь вы можете создать свой аккаунт в котором будут хранить ваши карточки <br>
                Также в аккаунте вы сможете просматривать различную статистику по вашим повторениям <br>
                Проходить тестирования <br>
                Создавать/редактировать/удалять группы и карточки <br>
                И дальше больше :)
            </p>
        </div>

        <form method="POST" id="auth_form">
            <input type="text" name="username" class="intext" placeholder="Login" maxlength="50"/>
            <input type="password" name="password" class="intext" aria-valuetext="Password" maxlength="50" placeholder="Password"/>
            <div class="formbuts">
                <input formaction="/register" type="submit" value="Регистрация" class="formbut" id="register_but" />
                <div></div>
                <input type="submit" value="Войти" class="formbut" formaction="/token" id="enter"/>
            </div>

        </form>
    </main>
    <footer>
        <p>&#169; Alexey Dolgikh 2022</p>
    </footer>
</body>
</html>